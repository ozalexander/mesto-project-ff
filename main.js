(()=>{"use strict";function e(e,t,n,o){var r=t.deleteThisCard,u=t.zoomPicture,c=t.cardLike,i=t.deleteCardByID,a=t.likeById,l=t.deleteLikeById,s=t.openPopup,p=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),d=p.querySelector(".card__title"),_=p.querySelector(".card__image"),f=p.querySelector(".card__like-button"),m=p.querySelector(".card__like-button-counter");_.src=e.link,_.alt=e.name,d.textContent=e.name,m.textContent=n,_.onerror=function(){_.src="https://media1.tenor.com/m/CBtVxFR3-oYAAAAC/error.gif",_.style.pointerEvents="none"};try{e.likes.some((function(e){return"10d544c5bdef65a02d074b65"===e._id}))&&f.classList.add("card__like-button_is-active")}catch(e){}if(o||"10d544c5bdef65a02d074b65"===e.owner._id){var v=document.createElement("button");v.className="card__delete-button",p.appendChild(v);var y=p.querySelector(".card__delete-button"),b=document.querySelector(".popup_type_delete");y.addEventListener("click",(function(){s(b,"popup_is-opened"),b.addEventListener("submit",(function(){r(p),i(e._id)}))}))}return _.addEventListener("click",(function(){return u(_)})),f.addEventListener("click",(function(){var t=Number(m.textContent);f.classList.contains("card__like-button_is-active")?(l(e._id),c(f,m),m.textContent=t-1):(c(f,m),a(e._id),m.textContent=t+1)})),p}function t(e,t){var o=function(o){return function(e,t,o){"Escape"===e.key&&n(t,o)}(o,e,t)},r=function(){return function(e,t){return n(e,t)}(e,t)};e.classList.add(t),e.addEventListener("click",r),document.addEventListener("keydown",o),e.closeByOuterClickEvt=r,e.closeByEscEvt=o}function n(e,t){e.classList.remove(t),e.removeEventListener("click",e.closeByOuterClickEvt),document.removeEventListener("keydown",e.closeByEscEvt)}for(var o,r,u,c,i,a,l,s=function(e,t,n,o){t.validity.valid?d(e,t,n,o):p(e,t,t.validationMessage,n,o)},p=function(e,t,n,o,r){var u=e.querySelector(".".concat(t.name,"-popup__error"));t.classList.add(o),u.classList.add(r),u.textContent=n},d=function(e,t,n,o){var r=e.querySelector(".".concat(t.name,"-popup__error"));t.classList.remove(n),r.classList.remove(o)},_=function(e,t){var n=t.submitButtonSelector,o=t.inactiveButtonClass,r=t.errorClass;e.querySelectorAll(r).forEach((function(e){return e.textContent=""})),e.querySelector(n).classList.add(o)},f={baseUrl:"https://nomoreparties.co/v1/wff-cohort-15",headers:{authorization:"ba744ed5-837c-473f-902f-5686fb20a2a0","Content-Type":"application/json"}},m="/cards/",v="/users/me",y=m+"/likes/",b=v+"/avatar",h=function(e,t){return fetch(f.baseUrl+v,{method:"PATCH",headers:f.headers,body:JSON.stringify({name:e.textContent,about:t.textContent})})},S=function(e,t){return fetch(f.baseUrl+m,{method:"POST",headers:f.headers,body:JSON.stringify({name:e.value,link:t.value})})},C=document.querySelectorAll(".popup"),L=document.querySelectorAll(".popup__close"),q=document.querySelectorAll(".popup__content"),E=document.querySelectorAll(".popup__form"),k=document.querySelector(".popup__image"),g=document.querySelector(".popup__caption"),x=document.querySelector(".popup__input_type_card-name"),B=document.querySelector(".popup__input_type_url"),A=document.querySelector(".places__list"),T=document.querySelector(".profile__edit-button"),P=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),D=document.querySelector(".profile__image"),I=document.querySelector(".popup__input_avatar"),N=document.querySelector(".popup__input_type_name"),O=document.querySelector(".popup__input_type_description"),w=document.querySelector(".profile__add-button"),j=document.querySelector(".popup_type_error"),z="popup_is-opened",J={deleteThisCard:function(e){return e.remove()},zoomPicture:function(e){M(2),k.src=e.src,k.alt=e.alt,g.textContent=e.alt},cardLike:function(e,t){e.classList.toggle("card__like-button_is-active"),t.classList.toggle("card__like-button-counter-change")},deleteCardByID:function(e){fetch("".concat(f.baseUrl).concat(m).concat(e),{method:"DELETE",headers:f.headers})},likeById:function(e){fetch("".concat(f.baseUrl).concat(y).concat(e),{method:"PUT",headers:f.headers})},deleteLikeById:function(e){fetch("".concat(f.baseUrl).concat(y).concat(e),{method:"DELETE",headers:f.headers})},openPopup:t},M=function(e){return t(C[e],z)},V=function(e){return n(C[e],z)},H=0;H<C.length;H++)C[H].classList.add("popup_is-animated");function F(){x.value="",B.value="",_(E[1],{submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",errorClass:".popup__error_visible"})}function R(e){q[e].addEventListener("click",(function(e){return e.stopPropagation()})),L[e].addEventListener("click",(function(){return V(e)}))}D.addEventListener("click",(function(){M(3),I.focus()})),T.addEventListener("click",(function(){M(0),N.focus(),_(E[0],{submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",errorClass:".popup__error_visible"})})),w.addEventListener("click",(function(){M(1),x.focus()})),E[0].addEventListener("submit",(function(e){return function(e){e.preventDefault(),E[0].querySelector(".popup__button").textContent="",E[0].querySelector(".popup__button").classList.add("popup__button-loading"),Promise.all([h(P,U)]).then((function(){setTimeout((function(){V(0)}),3e3)})).catch((function(e){return console.log(e)})).finally((function(){return setTimeout((function(){P.textContent=N.value,U.textContent=O.value,E[0].querySelector(".popup__button").textContent="Сохранено",E[0].querySelector(".popup__button").classList.remove("popup__button-loading")}),2e3)}))}(e)})),E[1].addEventListener("submit",(function(t){return function(t){t.preventDefault();var n=[];""===x.value&&""===B.value?V(1):(E[1].querySelector(".popup__button").textContent="",E[1].querySelector(".popup__button").classList.add("popup__button-loading"),Promise.all([S(x,B)]).then((function(){n.unshift({name:x.value,link:B.value}),A.insertBefore(e(n[0],J,0,!0),A.firstChild),n.shift(),setTimeout(F,600),setTimeout((function(){return V(1)}),3e3)})).catch((function(e){return console.log(e)})).finally((function(){return setTimeout((function(){E[1].querySelector(".popup__button").textContent="Сохранено",E[1].querySelector(".popup__button").classList.remove("popup__button-loading")}),2e3)})))}(t)})),E[2].addEventListener("submit",(function(e){return function(e){var t;e.preventDefault(),D.style.backgroundImage="url(".concat(I.value,")"),t=I.value,fetch(f.baseUrl+b,{method:"PATCH",headers:f.headers,body:JSON.stringify({avatar:t})}),V(3)}(e)})),E[3].addEventListener("submit",(function(e){return function(e){e.preventDefault(),V(4)}(e)})),j.addEventListener("submit",(function(e){e.preventDefault(),V(5)}));for(var Y=0;Y<C.length;Y++)R(Y);r=(o={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}).formSelector,u=o.inputSelector,c=o.submitButtonSelector,i=o.inactiveButtonClass,a=o.inputErrorClass,l=o.errorClass,document.querySelectorAll(r).forEach((function(e){!function(e,t,n,o,r,u){var c=Array.from(e.querySelectorAll(t));c.forEach((function(t){t.addEventListener("input",(function(){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}(c,e.querySelector(r),u),s(e,t,n,o)}))}))}(e,u,a,l,c,i)}));var G=function(e){return e.ok?e.json():(C[5].querySelector(".popup__title").textContent="Ошибка: ".concat(e.status),M(5),Promise.reject("Ошибка: ".concat(e.status)))};fetch(f.baseUrl+m,{headers:f.headers}).then((function(e){return G(e)})).then((function(t){t.forEach((function(t){return A.append(e(t,J,t.likes.length))}))})).catch((function(e){return console.log(e)})),fetch(f.baseUrl+v,{headers:f.headers}).then((function(e){return G(e)})).then((function(e){P.textContent=e.name,U.textContent=e.about,N.value=P.textContent,O.value=U.textContent,D.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){return console.log(e)}))})();