(()=>{"use strict";function e(e,t,n){var r=t.zoomPicture,o=t.deleteCard,u=t.handleLikes,c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__delete-button"),i=c.querySelector(".card__title"),l=c.querySelector(".card__image"),s=c.querySelector(".card__like-button"),p=c.querySelector(".card__like-button-counter"),d="card__like-button_is-active",f={like:s,count:p};return l.src=e.link,l.alt=e.name,i.textContent=e.name,p.textContent=e.likes.length,e.likes.some((function(e){return e._id===n}))&&s.classList.add(d),e.owner._id===n?a.addEventListener("click",(function(){return o(e._id,c)})):a.remove(),s.addEventListener("click",(function(){return u(e._id,f,s.classList.contains(d))})),l.addEventListener("click",(function(){return r(l)})),c}var t="popup_is-opened",n=function(e){"Escape"===e.key&&o(document.querySelector(".".concat(t)))};function r(e){e.classList.add(t),e.addEventListener("click",(function(t){return function(e,t){e.target===t&&o(t)}(t,e)})),document.addEventListener("keydown",n)}function o(e){e.classList.remove(t),document.removeEventListener("keydown",n)}var u=function(e,t,n,r){t.validity.valid?a(e,t,n,r):c(e,t,t.validationMessage,n,r)},c=function(e,t,n,r,o){var u=e.querySelector(".".concat(t.name,"-popup__error"));t.classList.add(r),u.classList.add(o),u.textContent=n},a=function(e,t,n,r){var o=e.querySelector(".".concat(t.name,"-popup__error"));t.classList.remove(n),o.classList.remove(r)},i=function(e,t){var n=t.submitButtonSelector,r=t.inputSelector,o=t.inactiveButtonClass,u=t.inputErrorClass,c=t.errorClass;e.querySelectorAll(r).forEach((function(t){return a(e,t,u,c)})),e.querySelector(n).classList.add(o)},l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-15",headers:{authorization:"ba744ed5-837c-473f-902f-5686fb20a2a0","Content-Type":"application/json"}};function s(e){return e.ok?e.json():e.json().then((function(t){return t.httpResponseCode=e.status,Promise.reject(t)}))}var p="/cards/",d="/users/me",f=p+"/likes/",_=d+"/avatar";function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var m=document.querySelectorAll(".popup"),v=document.querySelectorAll(".popup__content"),h=".popup__form",S=document.querySelector(".popup__image"),b=document.querySelector(".popup__caption"),q=document.querySelector(".popup__input_type_card-name"),C=document.querySelector(".popup__input_type_url"),E=document.querySelector(".places__list"),L=document.querySelector(".profile__edit-button"),g=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),A=document.querySelector(".popup__input_avatar"),U=document.getElementsByName("confirm-delete")[0],w=document.querySelector(".popup__input_type_name"),P=document.querySelector(".popup__input_type_description"),j=document.querySelector(".profile__add-button"),T=document.querySelector(".popup_type_edit"),B=document.querySelector(".popup_type_new-card"),D=document.querySelector(".popup_type_image"),O=document.querySelector(".popup_type_avatar"),I=document.querySelector(".popup_type_delete"),N=document.querySelector(".popup_type_error"),M=N.querySelector(h),z=T.querySelector(h),J=B.querySelector(h),H=O.querySelector(h),R={zoomPicture:function(e){r(D),S.src=e.src,S.alt=e.alt,b.textContent=e.alt},deleteCard:function(e,t){Y={id:e,element:t},r(I)},handleLikes:function(e,t,n){var r,o;(r=e,o=n,fetch(l.baseUrl+f+r,{method:o?"DELETE":"PUT",headers:l.headers}).then(s)).then((function(e){return function(e,t){e.count.textContent=t,e.count.classList.toggle("card__like-button-counter-change"),e.like.classList.toggle("card__like-button_is-active")}(t,e.likes.length)})).catch(Z)}},V={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};m.forEach((function(e){return e.classList.add("popup_is-animated")})),x.addEventListener("click",(function(){r(O),A.value="",A.focus(),i(H,V)})),L.addEventListener("click",(function(){r(T),w.value=g.textContent,P.value=k.textContent,w.focus(),i(z,V)})),j.addEventListener("click",(function(){r(B),q.focus(),i(J,V)})),z.addEventListener("submit",(function(e){return function(e){e.preventDefault(),z.querySelector(".popup__button").textContent="Сохранение...",function(e,t){return fetch(l.baseUrl+d,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e.value,about:t.value})}).then(s)}(w,P).then((function(){g.textContent=w.value,k.textContent=P.value,o(T)})).catch(Z).finally(z.querySelector(".popup__button").textContent="Сохранить")}(e)})),J.addEventListener("submit",(function(t){return function(t){t.preventDefault(),J.querySelector(".popup__button").textContent="Сохранение...",function(e,t){return fetch(l.baseUrl+p,{method:"POST",headers:l.headers,body:JSON.stringify({name:e.value,link:t.value})}).then(s)}(q,C).then((function(t){E.prepend(e(t,R,t.owner._id)),o(B),q.value="",C.value=""})).catch(Z).finally(J.querySelector(".popup__button").textContent="Сохранить")}(t)}));var $,F,G,K,Q,W,X,Y=null;U.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=Y.id,fetch(l.baseUrl+p+t,{method:"DELETE",headers:l.headers}).then(s)).then((function(){Y.element.remove(),o(I),Y={}})).catch(Z)})),H.addEventListener("submit",(function(e){return function(e){var t;e.preventDefault(),H.querySelector(".popup__button").textContent="Сохранение...",(t=A.value,fetch(l.baseUrl+_,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then(s)).then((function(){o(O),x.style.backgroundImage="url(".concat(A.value,")")})).catch(Z).finally(H.querySelector(".popup__button").textContent="Сохранить")}(e)})),v.forEach((function(e){return e.addEventListener("click",(function(e){return e.stopPropagation()}))})),m.forEach((function(e){return e.querySelector(".popup__close").addEventListener("click",(function(){return o(e)}))})),M.addEventListener("submit",(function(e){e.preventDefault(),o(N)})),F=($=V).formSelector,G=$.inputSelector,K=$.submitButtonSelector,Q=$.inactiveButtonClass,W=$.inputErrorClass,X=$.errorClass,document.querySelectorAll(F).forEach((function(e){!function(e,t,n,r,o,c){var a=Array.from(e.querySelectorAll(t));a.forEach((function(t){t.addEventListener("input",(function(){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):t.classList.add(n)}(a,e.querySelector(o),c),u(e,t,n,r)}))}))}(e,G,W,X,K,Q)}));var Z=function(e){console.log(e),N.querySelector(".popup__title").textContent="".concat(e.message,". Ошибка: ").concat(e.httpResponseCode),r(N)};Promise.all([fetch(l.baseUrl+p,{headers:l.headers}).then(s),fetch(l.baseUrl+d,{headers:l.headers}).then(s)]).then((function(t){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,u,c,a=[],i=!0,l=!1;try{if(u=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=u.call(n)).done)&&(a.push(r.value),a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return a}}(n,r)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=o[0],c=o[1];u.forEach((function(t){return E.append(e(t,R,c._id))})),g.textContent=c.name,k.textContent=c.about,x.style.backgroundImage="url(".concat(c.avatar,")")})).catch(Z)})();